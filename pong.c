#include <stdio.h>

// Объявление функций
void out(int ball_x, int ball_y, int play1_y, int play2_y);
int otskok(int ball_x, int ball_y, int play1_y, int play2_y);
int modul(int x);

int main() {
    // Инициализация позиций мяча и ракеток
    int ball_x = 80 / 2;    // Начальная позиция мяча по оси X (центр поля)
    int ball_y = 25 / 2;    // Начальная позиция мяча по оси Y (центр поля)
    int play1_y = 25 / 2;   // Начальная позиция левой ракетки по оси Y
    int play2_y = 25 / 2;   // Начальная позиция правой ракетки по оси Y
    
    int vector_x = 1;        // Направление движения мяча по оси X (1 — вправо, -1 — влево)
    int vector_y = 1;        // Направление движения мяча по оси Y (1 — вниз, -1 — вверх)
    
    int wins1 = 0;           // Счёт для левого игрока
    int wins2 = 0;           // Счёт для правого игрока
    int a = 0;               // Код столкновения
    
    // Очистка экрана и перемещение курсора в начало (закомментировано)
    // printf("\x1b[2J"); // Очистка экрана
    // printf("\x1b[d");   // Перемещение курсора в начало
    
    // Отображение начального состояния игрового поля
    out(ball_x, ball_y, play1_y, play2_y);
    
    // Основной цикл игры: продолжается, пока один из игроков не наберёт 2 победы
    while (wins1 < 2 && wins2 < 2) {
        char enter = getchar(); // Чтение ввода пользователя
        
        // Проверка допустимых команд для управления ракетками или движением мяча
        if (enter == 'a' || enter == 'z' || enter == 'k' || enter == 'm' || enter == ' ') {
            // Управление левой ракеткой
            if (enter == 'a') play1_y--; // Перемещение вверх
            if (enter == 'z') play1_y++; // Перемещение вниз
            
            // Управление правой ракеткой
            if (enter == 'k') play2_y--; // Перемещение вверх
            if (enter == 'm') play2_y++; // Перемещение вниз
            
            // Обновление позиции мяча
            ball_x += vector_x;
            ball_y += vector_y;
            
            // Проверка столкновений
            a = otskok(ball_x, ball_y, play1_y, play2_y);
            
            // Обработка типа столкновения
            if (a == 1) vector_x *= -1; // Отражение по горизонтали
            if (a == 2) vector_y *= -1; // Отражение по вертикали
            if (a == 3) { // Гол правого игрока
                wins2++;
                // Сброс позиции мяча в центр
                ball_x = 80 / 2;
                ball_y = 25 / 2;
            }
            if (a == 4) { // Гол левого игрока
                wins1++;
                // Сброс позиции мяча в центр
                ball_x = 80 / 2;
                ball_y = 25 / 2;
            }
        }
        
        // Очистка экрана и перемещение курсора в начало (закомментировано)
        printf("\x1b[d");  // Перемещение курсора в начало
        printf("\x1b[2J"); // Очистка экрана
        
        // Отображение обновлённого состояния игрового поля
        out(ball_x, ball_y, play1_y, play2_y);
        
        // Вывод текущего счёта
        printf("Игрок слева:  %d     Игрок справа:  %d\n", wins1, wins2);
    }
    
    // Вывод результата игры
    (wins1 == 2) ? printf("Игрок слева победил!\n") : printf("Игрок справа победил\n");
    
    return 0;
}

// Функция отображения игрового поля
void out(int ball_x, int ball_y, int play1_y, int play2_y){
    for (int y = 0; y <= 25; y++) {           // Проход по строкам
        for (int x = 0; x <= 80; x++) {       // Проход по столбцам
            if (y == 0 || y == 25)
                printf("#");                   // Верхняя и нижняя границы
            else if (x == 0 || x == 80)
                printf("#");                   // Левая и правая границы
            else if (((y >= (play1_y - 1) && y <= (play1_y + 1)) && x == 15) ||
                     ((y >= (play2_y - 1) && y <= (play2_y + 1)) && x == 65))
                printf("|");                   // Ракетки игроков
            else if (x == ball_x && y == ball_y)
                printf("o");                   // Мяч
            else
                printf(" ");                   // Пустые места
        }
        printf("\n");                           // Переход на новую строку
    }
}

// Функция определения типа столкновения мяча
int otskok(int ball_x, int ball_y, int play1_y, int play2_y) {
    int kod = 0;
    
    // Проверка столкновения с ракетками
    if (((ball_x - 15 == 1) && (modul(ball_y - play1_y) <= 1)) || // Столкновение с левой ракеткой
        ((ball_x - 65 == -1) && (modul(ball_y - play2_y) <= 1)))  // Столкновение с правой ракеткой
        kod = 1;
    
    // Проверка столкновения со стенами по вертикали
    if (ball_y == 1 || ball_y == 23) kod = 2;
    
    // Проверка гола правого игрока
    if (ball_x == 1) kod = 3;
    
    // Проверка гола левого игрока
    if (ball_x == 79) kod = 4;
    
    return kod;
}

// Функция вычисления абсолютного значения числа
int modul(int x) {
    if (x < 0) x *= -1;
    return x;
}
